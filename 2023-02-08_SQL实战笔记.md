## SQL实战笔记   

更新: 2023-02-08 | 创建: 2023-02-08

参考书籍: [《SQL 必知必会》](https://book.douban.com/subject/24250054/)    

![SQL 必知必会](https://img9.doubanio.com/view/subject/s/public/s28341985.jpg)   

*资源直达: [夸克盘](https://pan.quark.cn/s/547e4fe5e6cb) ( 提取码: ACZa )* 

### Part-1  SQL基础知识

#### 1.1 查询操作

- [ ] **检索数据**   

```SQL
SELECT prod_name
FROM Products
ORDER BY prod_name
```

- [ ] **过滤数据**   

```SQL
SELECT prod_name
FROM Products
WHERE prod_price = 3.49
``` 

- [ ] **函数**   

```SQL
  LENGTH ()
  UPPER ()
  LEFT ()
  RIGHT ()
  LOWER ()
  LTRIM ()
  RTRIM ()
``` 

- [ ] **分组数据**   

```SQL
SELECT vend_id, COUNT(*) AS num_prods
FROM Products
WHERE prod_price >= 4
GROUP BY vend_id
HAVING COUNT(*) >= 2
ORDER BY items, order_num
``` 

- [ ] **子查询**   

```SQL
SELECT cust_id
FROM Orders
WHERE order_num IN (SELECT order_num FROM OrderItems WHERE prod_id = 'RGAN01')
``` 

- [ ] **使用视图检索数据**   

```SQL
SELECT cust_name, cust_contact
FROM ProductCustomers
WHERE prod_id = 'RGAN01';
``` 
***ProductCustomers**是一个视图*
*视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询*

#### 1.2 表操作

- [ ] **创建表**   
```SQL
CREATE TABLE Products
(
	prod_id    CHAR(10)      NOT NULL,
	vend_id    CHAR(10)      NOT NULL,
	prod_name  CHAR(254)     NOT NULL,
	prod_proce DECIMAL(8,2)  NOT NULL,
	prod_desc  VARCHAR(1000) NULL
)
```  

- [ ] **更新表**   
```SQL
ALTER TABLE Vendors
ADD vend_phone CHAR(20);
```  

- [ ] **删除表**   
```SQL
DROP TABLE CustCopy;
```  

- [ ] **简单联结**   
   
　**_方法一_**   

```SQL
SELECT vend_name, prod_name, prod_price
FROM Vendors, Products
WHERE Vendors.vend_id = Products.vend_id;
```  
*注意：在该情况下，要保证所有的联结都有 **WHERE**字句，否则会返回笛卡尔积 ( **cross join** ) 的不正确数据*  

　**_方法二_**  

```SQL
SELECT vend_name, prod_name, prod_price
FROM Vendors INNER JOIN Products
ON Vendors.vend_id = Products.vend_id;
``` 
*使用 **INNER JOIN** 联结时，联结条件用特定的 **ON** 字句而不是 **WHERE**字句*    
***ANSI SQL** 规范首选 **INNER JOIN** 语法*    

- [ ] **多个表联结**   
```SQL
SELECT cust_name, cust_contact
FROM Customers, Orders, OrderItems
WHERE Customers.cust_id = Orders.cust_id
AND OrderItems.order_num = Orders.order_num
AND prod_id = 'RGAN01';
``` 
*子查询并不总是执行复杂SELECT操作最好方法，使用联结查询往往会更有效*


- [ ] **使用带聚集函数的联结**   
```SQL
SELECT Customers.cust_id,
       COUNT(Orders.order_num) AS num_ord
FROM Customers INNER JOIN Orders
ON Customers.cust_id = Orders.cust_id
GROUP BY Customers.cust_id;
``` 
*函数调用 **COUNT ( Orders.order_num )** 对每个顾客的订单计数，将它作为 **num_ord** 返回*
***AS**用于使用表别名*


- [ ] **组合联结**   
```SQL
UNION
UNION ALL 
``` 
*使用UNION ALL不会取消重复的行*

#### 1.3 数据操作

- [ ] **插入数据**   
```SQL
INSERT INTO Customers(cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country)
VALUES('10005', 'Toy Land', '123 Any Street', 'New York', 'NY', '11111', 'USA');
``` 

- [ ] **更新数据**   
```SQL
UPDATE Customers
SET cust_email = 'kim@thetoystore.com'
WHERE cust_id = '10005';
``` 

- [ ] **删除数据**   
```SQL
DELETE FROM Customers
WHERE cust_id = '10006';
``` 

### Part-2  SQL题目实战

LeetCode 练习题: [Employees Earning More Than Their Managers](https://leetcode.com/problems/employees-earning-more-than-their-managers/)   



